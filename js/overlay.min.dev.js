(function($){$.tools=$.tools||{};$.tools.overlay={version:'1.1.2',addEffect:function(name,loadFn,closeFn){effects[name]=[loadFn,closeFn]},conf:{top:'10%',left:'center',absolute:false,speed:'normal',closeSpeed:'fast',effect:'default',close:null,oneInstance:true,closeOnClick:true,closeOnEsc:true,api:false,expose:null,target:null}};var effects={};$.tools.overlay.addEffect('default',function(onLoad){this.getOverlay().fadeIn(this.getConf().speed,onLoad)},function(onClose){this.getOverlay().fadeOut(this.getConf().closeSpeed,onClose)});var instances=[];function Overlay(trigger,conf){var self=this,$self=$(this),w=$(window),closers,overlay,opened,expose=conf.expose&&$.tools.expose.version;var jq=conf.target||trigger.attr("rel");overlay=jq?$(jq):null||trigger;if(!overlay.length){throw"Could not find Overlay: "+jq}if(trigger&&trigger.index(overlay)==-1){trigger.click(function(e){self.load(e);return e.preventDefault()})}$.each(conf,function(name,fn){if($.isFunction(fn)){$self.bind(name,fn)}});$.extend(self,{load:function(e){if(self.isOpened()){return self}var eff=effects[conf.effect];if(!eff){throw"Overlay: cannot find effect : \""+conf.effect+"\""}if(conf.oneInstance){$.each(instances,function(){this.close(e)})}e=e||$.Event();e.type="onBeforeLoad";$self.trigger(e);if(e.isDefaultPrevented()){return self}opened=true;if(expose){overlay.expose().load(e)}var top=conf.top;var left=conf.left;var oWidth=overlay.outerWidth({margin:true});var oHeight=overlay.outerHeight({margin:true});if(typeof top=='string'){top=top=='center'?Math.max((w.height()-oHeight)/2,0):parseInt(top,10)/100*w.height()}if(left=='center'){left=Math.max((w.width()-oWidth)/2,0)}if(!conf.absolute){top+=w.scrollTop();left+=w.scrollLeft()}overlay.css({top:top,left:left,position:'absolute'});e.type="onStart";$self.trigger(e);eff[0].call(self,function(){if(opened){e.type="onLoad";$self.trigger(e)}});if(conf.closeOnClick){$(document).bind("click.overlay",function(e){if(!self.isOpened()){return}var et=$(e.target);if(et.parents(overlay).length>1){return}$.each(instances,function(){this.close(e)})})}if(conf.closeOnEsc){$(document).unbind("keydown.overlay").bind("keydown.overlay",function(e){if(e.keyCode==27){$.each(instances,function(){this.close(e)})}})}return self},close:function(e){if(!self.isOpened()){return self}e=e||$.Event();e.type="onBeforeClose";$self.trigger(e);if(e.isDefaultPrevented()){return}opened=false;effects[conf.effect][1].call(self,function(){e.type="onClose";$self.trigger(e)});var allClosed=true;$.each(instances,function(){if(this.isOpened()){allClosed=false}});if(allClosed){$(document).unbind("click.overlay").unbind("keydown.overlay")}return self},getContent:function(){return overlay},getOverlay:function(){return overlay},getTrigger:function(){return trigger},getClosers:function(){return closers},isOpened:function(){return opened},getConf:function(){return conf},bind:function(name,fn){$self.bind(name,fn);return self},unbind:function(name){$self.unbind(name);return self}});$.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(i,ev){self[ev]=function(fn){return self.bind(ev,fn)}});if(expose){if(typeof conf.expose=='string'){conf.expose={color:conf.expose}}$.extend(conf.expose,{api:true,closeOnClick:conf.closeOnClick,closeOnEsc:false});var ex=overlay.expose(conf.expose);ex.onBeforeClose(function(e){self.close(e)});self.onClose(function(e){ex.close(e)})}closers=overlay.find(conf.close||".close");if(!closers.length&&!conf.close){closers=$('<div class="close"></div>');overlay.prepend(closers)}closers.click(function(e){self.close(e)})}$.fn.overlay=function(conf){var el=this.eq(typeof conf=='number'?conf:0).data("overlay");if(el){return el}if($.isFunction(conf)){conf={onBeforeLoad:conf}}var globals=$.extend({},$.tools.overlay.conf);conf=$.extend(true,globals,conf);this.each(function(){el=new Overlay($(this),conf);instances.push(el);$(this).data("overlay",el)});return conf.api?el:this}})(jQuery);(function($){var t=$.tools.overlay;t.plugins=t.plugins||{};t.plugins.gallery={version:'1.0.0',conf:{imgId:'img',next:'.ow_next',prev:'.ow_prev',info:'.ow_info',progress:'.ow_progress',disabledClass:'ow_disabled',activeClass:'active',opacity:0.8,speed:'slow',template:'<strong>${title}</strong> <span>Image ${index} of ${total}</span>',autohide:true,preload:true,api:false}};$.fn.gallery=function(opts){var conf=$.extend({},t.plugins.gallery.conf),api;$.extend(conf,opts);api=this.overlay();var links=this,overlay=api.getOverlay(),next=overlay.find(conf.next),prev=overlay.find(conf.prev),info=overlay.find(conf.info),progress=overlay.find(conf.progress),els=prev.add(next).add(info).css({opacity:conf.opacity}),close=api.getClosers(),index;function load(el){progress.fadeIn();els.hide();close.hide();var url=el.attr("href");var image=new Image();image.onload=function(){progress.fadeOut();var img=$("#"+conf.imgId,overlay);if(!img.length){img=$("<img/>").attr("id",conf.imgId).css("visibility","hidden");overlay.prepend(img)}img.attr("src",url).css("visibility","hidden");var width=image.width;var left=($(window).width()-width)/2;index=links.index(links.filter("[href="+url+"]"));links.removeClass(conf.activeClass).eq(index).addClass(conf.activeClass);var cls=conf.disabledClass;els.removeClass(cls);if(index===0){prev.addClass(cls)}if(index==links.length-1){next.addClass(cls)}var text=conf.template.replace("${title}",el.attr("title")||el.data("title")).replace("${index}",index+1).replace("${total}",links.length);var padd=parseInt(info.css("paddingLeft"),10)+parseInt(info.css("paddingRight"),10);info.html(text).css({width:width-padd});overlay.animate({width:width,height:image.height,left:left},conf.speed,function(){img.hide().css("visibility","visible").fadeIn(function(){if(!conf.autohide){els.fadeIn();close.show()}})})};image.onerror=function(){overlay.fadeIn().html("Cannot find image "+url)};image.src=url;if(conf.preload){links.filter(":eq("+(index-1)+"), :eq("+(index+1)+")").each(function(){var img=new Image();img.src=$(this).attr("href")})}}function addClick(el,isNext){el.click(function(){if(el.hasClass(conf.disabledClass)){return}var trigger=links.eq(i=index+(isNext?1:-1));if(trigger.length){load(trigger)}})}addClick(next,true);addClick(prev);$(document).keydown(function(evt){if(!overlay.is(":visible")||evt.altKey||evt.ctrlKey){return}if(evt.keyCode==37||evt.keyCode==39){var btn=evt.keyCode==37?prev:next;btn.click();return evt.preventDefault()}return true});function showEls(){if(!overlay.is(":animated")){els.show();close.show()}}if(conf.autohide){overlay.hover(showEls,function(){els.fadeOut();close.hide()}).mousemove(showEls)}var ret;this.each(function(){var el=$(this),api=$(this).overlay(),ret=api;api.onBeforeLoad(function(){load(el)});api.onClose(function(){links.removeClass(conf.activeClass)})});return conf.api?ret:this}})(jQuery);(function($){$.tools=$.tools||{};$.tools.expose={version:'1.0.5',conf:{maskId:null,loadSpeed:'slow',closeSpeed:'fast',closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:0.8,color:'#456',api:false}};function viewport(){if($.browser.msie){var d=$(document).height(),w=$(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,d-w<20?w:d]}return[$(window).width(),$(document).height()]}function Expose(els,conf){var self=this,$self=$(this),mask=null,loaded=false,origIndex=0;$.each(conf,function(name,fn){if($.isFunction(fn)){$self.bind(name,fn)}});$(window).resize(function(){self.fit()});$.extend(this,{getMask:function(){return mask},getExposed:function(){return els},getConf:function(){return conf},isLoaded:function(){return loaded},load:function(e){if(loaded){return self}origIndex=els.eq(0).css("zIndex");if(conf.maskId){mask=$("#"+conf.maskId)}if(!mask||!mask.length){var size=viewport();mask=$('<div/>').css({position:'absolute',top:0,left:0,width:size[0],height:size[1],display:'none',opacity:0,zIndex:conf.zIndex});if(conf.maskId){mask.attr("id",conf.maskId)}$("body").append(mask);var bg=mask.css("backgroundColor");if(!bg||bg=='transparent'||bg=='rgba(0, 0, 0, 0)'){mask.css("backgroundColor",conf.color)}if(conf.closeOnEsc){$(document).bind("keydown.unexpose",function(evt){if(evt.keyCode==27){self.close()}})}if(conf.closeOnClick){mask.bind("click.unexpose",function(e){self.close(e)})}}e=e||$.Event();e.type="onBeforeLoad";$self.trigger(e);if(e.isDefaultPrevented()){return self}$.each(els,function(){var el=$(this);if(!/relative|absolute|fixed/i.test(el.css("position"))){el.css("position","relative")}});els.css({zIndex:Math.max(conf.zIndex+1,origIndex=='auto'?0:origIndex)});var h=mask.height();if(!this.isLoaded()){mask.css({opacity:0,display:'block'}).fadeTo(conf.loadSpeed,conf.opacity,function(){if(mask.height()!=h){mask.css("height",h)}e.type="onLoad";$self.trigger(e)})}loaded=true;return self},close:function(e){if(!loaded){return self}e=e||$.Event();e.type="onBeforeClose";$self.trigger(e);if(e.isDefaultPrevented()){return self}mask.fadeOut(conf.closeSpeed,function(){e.type="onClose";$self.trigger(e);els.css({zIndex:$.browser.msie?origIndex:null})});loaded=false;return self},fit:function(){if(mask){var size=viewport();mask.css({width:size[0],height:size[1]})}},bind:function(name,fn){$self.bind(name,fn);return self},unbind:function(name){$self.unbind(name);return self}});$.each("onBeforeLoad,onLoad,onBeforeClose,onClose".split(","),function(i,ev){self[ev]=function(fn){return self.bind(ev,fn)}})}$.fn.expose=function(conf){var el=this.eq(typeof conf=='number'?conf:0).data("expose");if(el){return el}if(typeof conf=='string'){conf={color:conf}}var globals=$.extend({},$.tools.expose.conf);conf=$.extend(globals,conf);this.each(function(){el=new Expose($(this),conf);$(this).data("expose",el)});return conf.api?el:this}})(jQuery);